{% extends "base.html" %}
{% block title %}Survey Result{% endblock %}

{% block content %}
<style>
body {
    background-image: url('/static/images/healthcare_bg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    font-family: 'Poppins', sans-serif;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 800px;
    margin: 40px auto;
    padding: 30px;
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

h2 {
    text-align: center;
    font-size: 2rem;
    font-weight: 600;
    color: #0d6efd;
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid #0d6efd;
    display: inline-block;
    padding-bottom: 5px;
}

.section {
    margin-bottom: 20px;
    padding: 15px;
    border-left: 5px solid #0d6efd;
    background: #f9f9f9;
    border-radius: 10px;
}

.risk-low { color: #28a745; font-weight: 600; }
.risk-moderate { color: #ffc107; font-weight: 600; }
.risk-high { color: #dc3545; font-weight: 600; }

.xray-img {
    max-width: 100%;
    border-radius: 10px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    margin-top: 10px;
}

button, .btn-link {
    background: #0d6efd;
    color: white;
    border: none;
    padding: 10px 18px;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    font-weight: 500;
    text-decoration: none;
    display: inline-block;
}
button:hover, .btn-link:hover {
    background: #0b5ed7;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

input[type="file"] {
    display: block;
    margin: 10px 0 20px 0;
}

.center-button {
    text-align: center;
}

a {
    color: #0d6efd;
    text-decoration: none;
    font-weight: 500;
}
a:hover {
    text-decoration: underline;
}
</style>

<div class="container">
    {% if session.lang == 'en' %}
        <h2>Survey Result</h2>
    {% elif session.lang == 'hi' %}
        <h2>‡§∏‡§∞‡•ç‡§µ‡•á‡§ï‡•ç‡§∑‡§£ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h2>
    {% elif session.lang == 'kn' %}
        <h2>‡≤∏‡≤Æ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤æ ‡≤´‡≤≤‡≤ø‡≤§‡≤æ‡≤Ç‡≤∂</h2>
    {% endif %}

    <!-- Risk Level & Suggestion -->
    <div class="section">
        {% if session.lang == 'en' %}
            <p><b>Risk Level:</b> <span class="risk-{{ survey.risk }}">{{ survey.risk|capitalize }}</span></p>
            <p><b>Suggestion:</b> {{ survey.suggestion }}</p>
        {% elif session.lang == 'hi' %}
            <p><b>‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞:</b> <span class="risk-{{ survey.risk }}">{{ survey.risk|capitalize }}</span></p>
            <p><b>‡§∏‡•Å‡§ù‡§æ‡§µ:</b> {{ survey.suggestion }}</p>
        {% elif session.lang == 'kn' %}
            <p><b>‡≤Ö‡≤™‡≤æ‡≤Ø‡≤¶ ‡≤Æ‡≤ü‡≥ç‡≤ü:</b> <span class="risk-{{ survey.risk }}">{{ survey.risk|capitalize }}</span></p>
            <p><b>‡≤∏‡≤≤‡≤π‡≥Ü:</b> {{ survey.suggestion }}</p>
        {% endif %}
    </div>

    <!-- X-ray Upload Section -->
    <div class="section">
        {% if survey.risk in ['low','moderate'] %}
            {% if not survey.xray_uploaded %}
                {% if session.lang == 'en' %}
                    <div style="background:#fff3cd; padding:10px; border-left:5px solid #ffc107; border-radius:8px;">
                        <b>{{ survey.risk|capitalize }} Risk Detected ‚Äì Recommended X-ray:</b> Uploading a chest X-ray is optional but recommended for confirmation.
                    </div>
                {% elif session.lang == 'hi' %}
                    <div style="background:#fff3cd; padding:10px; border-left:5px solid #ffc107; border-radius:8px;">
                        <b>{{ survey.risk|capitalize }} ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‚Äì ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á:</b> ‡§õ‡§æ‡§§‡•Ä ‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ ‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï ‡§π‡•à ‡§≤‡•á‡§ï‡§ø‡§® ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§π‡•à‡•§
                    </div>
                {% elif session.lang == 'kn' %}
                    <div style="background:#fff3cd; padding:10px; border-left:5px solid #ffc107; border-radius:8px;">
                        <b>{{ survey.risk|capitalize }} ‡≤Ö‡≤™‡≤æ‡≤Ø ‡≤™‡≤§‡≥ç‡≤§‡≥Ü‡≤Ø‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü ‚Äì ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥ç‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶ ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á:</b> ‡≤¶‡≥É‡≤¢‡≥Ä‡≤ï‡≤∞‡≤£‡≤ï‡≥ç‡≤ï‡≤æ‡≤ó‡≤ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥ç‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.
                    </div>
                {% endif %}
                <form action="{{ url_for('upload_xray') }}" method="post" enctype="multipart/form-data">
                    {% if session.lang == 'en' %}
                        <label><b>Optional: Upload Chest X-ray:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">Upload & Predict</button>
                    {% elif session.lang == 'hi' %}
                        <label><b>‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï: ‡§õ‡§æ‡§§‡•Ä ‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡•á‡§Ç</button>
                    {% elif session.lang == 'kn' %}
                        <label><b>‡≤ê‡≤ö‡≥ç‡≤õ‡≤ø‡≤ï: ‡≤õ‡≤æ‡≤§‡≤ø‡≤Ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ä‡≤π‡≤ø‡≤∏‡≤ø</button>
                    {% endif %}
                </form>
            {% else %}
                <div style="background:#d1ecf1; padding:10px; border-left:5px solid #17a2b8; border-radius:8px;">
                    ‚úÖ
                    {% if session.lang == 'en' %} X-ray uploaded successfully.
                    {% elif session.lang == 'hi' %} ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•Å‡§Ü‡•§
                    {% elif session.lang == 'kn' %} ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü. {% endif %}
                </div>
                <img class="xray-img" src="{{ url_for('serve_upload', fname=survey.xray_uploaded) }}" alt="Uploaded X-ray">
                <p><b>Prediction:</b> {{ survey.xray_prediction }} ({{ survey.ml_conf }}%)</p>
            {% endif %}
        {% elif survey.risk == 'high' %}
            {% if not survey.xray_uploaded %}
                <div style="background:#f8d7da; padding:10px; border-left:5px solid #dc3545; border-radius:8px;">
                    ‚ö†Ô∏è
                    {% if session.lang == 'en' %} High Risk Detected ‚Äì Mandatory X-ray required.
                    {% elif session.lang == 'hi' %} ‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‚Äì ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à‡•§
                    {% elif session.lang == 'kn' %} ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤® ‡≤Ö‡≤™‡≤æ‡≤Ø ‡≤™‡≤§‡≥ç‡≤§‡≥Ü‡≤Ø‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü ‚Äì ‡≤ï‡≤°‡≥ç‡≤°‡≤æ‡≤Ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥Ü. {% endif %}
                </div>
                <form action="{{ url_for('upload_xray') }}" method="post" enctype="multipart/form-data">
                    {% if session.lang == 'en' %}
                        <label><b>Upload Chest X-ray:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">Upload & Predict</button>
                    {% elif session.lang == 'hi' %}
                        <label><b>‡§õ‡§æ‡§§‡•Ä ‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡•á‡§Ç</button>
                    {% elif session.lang == 'kn' %}
                        <label><b>‡≤õ‡≤æ‡≤§‡≤ø‡≤Ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø:</b></label><br>
                        <input type="file" name="xray_file" accept="image/*" required>
                        <button type="submit">‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ä‡≤π‡≤ø‡≤∏‡≤ø</button>
                    {% endif %}
                </form>
            {% else %}
                <div style="background:#d1ecf1; padding:10px; border-left:5px solid #17a2b8; border-radius:8px;">
                    ‚úÖ
                    {% if session.lang == 'en' %} X-ray uploaded successfully.
                    {% elif session.lang == 'hi' %} ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•Å‡§Ü‡•§
                    {% elif session.lang == 'kn' %} ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç-‡≤∞‡≥á ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü. {% endif %}
                </div>
                <img class="xray-img" src="{{ url_for('serve_upload', fname=survey.xray_uploaded) }}" alt="Uploaded X-ray">
                <p><b>Prediction:</b> {{ survey.xray_prediction }} ({{ survey.ml_conf }}%)</p>
            {% endif %}
        {% endif %}
    <!-- üî• MODEL ACCURACY SECTION -->
<div class="section">
    <h3>Model Performance</h3>

    {% if acc_data %}
        <p><b>Training Accuracy:</b> {{ acc_data.train_acc }}%</p>
        <p><b>Validation Accuracy:</b> {{ acc_data.val_acc }}%</p>

        <div style="background:#e9f7ef; padding:10px; border-left:5px solid #28a745; border-radius:8px;">
            ‚úî Model evaluated using CNN on chest X-ray dataset.
        </div>
    {% else %}
        <p style="color:#856404;">
            ‚ö† Model performance data not available.
        </p>
    {% endif %}
</div>


    {% if survey.xray_uploaded %}
    <div class="section">
        <h3>Preprocessing Steps</h3>

        <!-- 1. Original -->
        <p><b>1. Original Image:</b></p>
        <img class="xray-img" src="/static/uploads/{{ survey.xray_uploaded }}">

        <!-- 2. Resized -->
        <p><b>2. Resized (224√ó224):</b></p>
        <img class="xray-img" src="{{ session.resized }}">

        <!-- 3. Normalized -->
        <p><b>3. Normalized:</b></p>
        <img class="xray-img" src="{{ session.normalized }}">

        <!-- 4. Grayscale -->
        <p><b>4. Grayscale:</b></p>
        <img class="xray-img" src="{{ session.gray }}">

        <!-- 5. Edge Detection -->
        <p><b>5. Edge Detection:</b></p>
        <img class="xray-img" src="{{ session.edges }}">
    </div>
    {% endif %}
    {% if session['paired_aug'] %}
<div class="section">
    <h3>Augmented Images (5)</h3>

    <!-- Augmentation Steps -->
    <div style="margin-bottom:20px; padding:10px; background:#f8f8f8; border-radius:10px;">
        <h4>Augmentation Steps Applied</h4>
        <ul style="line-height:1.6;">
            <li><strong>Rotated +20¬∞:</strong> Image rotated clockwise.</li>
            <li><strong>Horizontal Flip:</strong> Mirrored left-to-right.</li>
            <li><strong>Zoomed (1.2√ó):</strong> Slight zoom-in.</li>
            <li><strong>Shifted (20px):</strong> Moved up/down/left/right.</li>
            <li><strong>Sheared (15¬∞):</strong> Tilt/diagonal distortion.</li>
        </ul>
    </div>

    <!-- Display all augmented images with their names -->
    <div style="display:flex; flex-wrap:wrap; gap:20px; justify-content:center;">
        {% for img, name in session['paired_aug'] %}
        <div style="text-align:center; width:180px;">
            <img src="{{ img }}" width="160"
                 style="border:1px solid #ccc; border-radius:10px; box-shadow:0px 3px 8px rgba(0,0,0,0.2);">
            <p style="margin-top:5px; font-weight:bold;">{{ name }}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}




    <!-- Download PDF -->
    <div class="section center-button">
        {% if session.lang == 'en' %}
            <form method="post"><button type="submit">Download PDF Report</button></form>
        {% elif session.lang == 'hi' %}
            <form method="post"><button type="submit">‡§™‡•Ä‡§°‡•Ä‡§è‡§´ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button></form>
        {% elif session.lang == 'kn' %}
            <form method="post"><button type="submit">‡≤™‡≤ø‡≤°‡≤ø‡≤é‡≤´‡≥ç ‡≤µ‡≤∞‡≤¶‡≤ø ‡≤°‡≥å‡≤®‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø</button></form>
        {% endif %}
    </div>

    <!-- Back to Dashboard -->
    <div class="section center-button">
        {% if session.lang == 'en' %}
            <a href="{{ url_for('dashboard') }}" class="btn-link">‚¨Ö Back to Dashboard</a>
        {% elif session.lang == 'hi' %}
            <a href="{{ url_for('dashboard') }}" class="btn-link">‚¨Ö ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</a>
        {% elif session.lang == 'kn' %}
            <a href="{{ url_for('dashboard') }}" class="btn-link">‚¨Ö ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‚Äå‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç‚Äå‡≤ó‡≥Ü ‡≤π‡≤ø‡≤Ç‡≤§‡≤ø‡≤∞‡≥Å‡≤ó‡≤ø</a>
        {% endif %}
    </div>
</div>
{% endblock %}
